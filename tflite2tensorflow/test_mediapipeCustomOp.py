import tensorflow.compat.v1 as tf
from mediapipeCustomOp import Landmarks2TransformMatrix, TransformTensorBilinear, TransformLandmarks

def test_TransformLandmarks(mat):
    landmark2d =  tf.constant([[
        [0,0], [3,0], [6,0], [9,0], [12,0], [15,0], 
        [0,3], [3,3], [6,3], [9,3], [12,3], [15,3], 
        [0,6], [3,6], [6,6], [9,6], [12,6], [15,6], 
        [0,9], [3,9], [6,9], [9,9], [12,9], [15,9], 
        [0,12], [3,12], [6,12], [9,12], [12,12], [15,12], 
        [0,15], [3,15], [6,15], [9,15], [12,15], [15,15]
        ]], dtype=tf.float32)

    return TransformLandmarks(None, None, None, None, landmark2d, mat)

def test_Landmarks2TransformMatrix():
    custom_options = {'left_rotation_idx': 61, 
                      'right_rotation_idx': 291, 
                      'output_height': 16,
                      'output_width': 16,
                      'scale_x': 1.5,
                      'scale_y': 1.5,
                      'target_rotation_radians': 0.0,
                      'subset_idxs': [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291, 185, 40, 39, 37, 0, 267, 269, 270, 409, 78, 95, 88, 178, 87, 14, 317, 402, 318, 324, 308, 191, 80, 81, 82, 13, 312, 311, 310, 415, 76, 77, 90, 180, 85, 16, 315, 404, 320, 307, 306, 184, 74, 73, 72, 11, 302, 303, 304, 408, 62, 96, 89, 179, 86, 15, 316, 403, 319, 325, 292, 183, 42, 41, 38, 12, 268, 271, 272, 407]
                      }
    operator = {
              "opcode_index": 8,
              "inputs": [191],
              "outputs": [196],
              "builtin_options_type": "NONE",
              "custom_options": [],
              "custom_options_format": "FLEXBUFFERS"
            }

    import numpy as np
    np.arange(468*3)
    input_tensor = tf.constant([[[82.69198,133.18433,-5.4607606], [72.58358,120.57828,-13.203387], [79.687675,124.54027,-6.4164777], [69.83731,108.01087,-8.954793], [70.85973,116.69585,-14.385307], [70.88015,111.67474,-13.837503], [72.69452,98.39726,-8.762863], [61.766544,98.50245,17.31159], [71.44683,88.627365,-7.830439], [69.691345,83.42947,-8.740273], [66.986465,65.25616,-9.465672], [83.49582,134.93588,-4.7847714], [84.696045,136.30716,-3.7344441], [85.92987,137.14014,-2.229866], [86.19356,135.2254,-1.592754], [86.28329,137.00195,-1.5628929], [86.84924,139.08296,-1.9830523], [87.98798,141.14407,-1.6124293], [91.19314,144.72789,0.5600323], [74.82855,122.8088,-11.773726], [74.58114,122.80456,-6.5732956], [59.815014,85.32914,34.60405], [69.330124,100.63434,9.071998], [67.25627,101.37014,11.479114], [65.15735,101.650955,14.13871], [62.591145,99.816154,18.693998], [70.467384,99.32596,7.065773], [62.445477,92.5015,10.218302], [64.9909,92.59868,7.4429874], [60.510086,93.048096,13.272725], [59.775814,94.345955,15.604404], [62.968292,102.66689,21.19875], [86.82698,150.94614,11.782496], [60.989513,97.72433,18.721956], [64.606155,100.22398,38.947186], [61.746407,99.7925,25.747395], [69.64339,118.300735,8.673036], [79.94116,132.77379,-2.5356448], [82.69011,136.4053,-0.93857855], [78.43886,134.16609,2.1365542], [78.2097,135.7134,6.4810405], [81.45543,136.78435,2.5150883], [80.666435,137.35687,6.1436167], [80.464066,141.17752,13.758217], [70.62222,120.662056,-11.571587], [68.72108,117.05457,-12.354221], [56.49034,90.89218,18.53417], [71.16369,107.621635,3.5661488], [69.10333,120.38525,-0.52499366], [69.23071,118.17855,0.28033948], [66.009544,118.34592,18.49914], [68.90566,112.343376,-10.876712], [57.105984,87.11815,7.947423], [55.79602,88.524025,13.511475], [56.004116,79.018585,26.325848], [66.2315,88.697205,-2.908135], [67.41078,93.214745,6.3401814], [77.43978,138.22617,15.915503], [83.38672,134.00264,47.815525], [71.91139,122.439095,-0.9921266], [74.60438,123.54686,-3.441576], [79.2368,138.46088,14.177323], [80.06741,138.10449,12.246394], [54.601257,85.73803,15.524014], [70.76633,122.194496,0.89387023], [60.227722,86.95224,2.4918122], [58.60299,83.4613,1.9281342], [55.607193,69.752014,6.3701205], [54.357327,81.06083,20.642199], [56.593716,74.97057,4.6546497], [55.973705,89.02966,21.73791], [56.969906,86.435394,28.108315], [81.23196,134.84184,-1.911486], [79.901245,135.66136,2.247953], [79.33491,136.58627,6.041974], [73.176155,123.180984,-1.2876648], [79.69701,138.32866,13.034817], [80.57816,138.24763,10.094137], [80.433014,137.87569,11.881443], [70.64581,120.875725,-5.0684476], [81.83046,137.66893,6.366388], [82.740425,137.39374,3.4592535], [84.081116,137.25052,0.51562864], [88.3365,144.80867,3.1557064], [85.31652,141.0664,1.1278317], [84.354065,138.94856,0.8327769], [84.11899,136.99657,1.2672507], [84.4318,135.45647,1.1187435], [82.113716,136.46637,6.7532015], [81.72612,137.29813,6.548495], [81.439804,138.38408,6.4870305], [81.52988,139.62788,7.549737], [74.75425,131.73553,8.046553], [76.587685,116.6435,51.827015], [77.17892,123.80147,-8.30477], [81.46184,137.09294,9.772896], [80.99048,137.65514,9.673887], [76.45211,125.12517,-3.424053], [73.39493,124.481834,1.644138], [75.55239,124.40392,-3.5811281], [70.229195,110.227554,6.935301], [68.05756,113.38073,11.050431], [70.359406,119.951164,2.0413003], [54.38135,73.78071,16.474848], [54.316547,77.185745,12.955178], [55.44203,83.759094,8.933715], [82.7837,142.61719,10.764678], [63.665302,83.85131,-3.8544142], [61.01723,74.050865,-2.4479659], [59.674065,67.22398,-2.492506], [63.538074,101.09018,16.847122], [63.10116,105.52336,24.904184], [70.87229,98.138466,6.412533], [59.444847,95.4394,19.786816], [71.40414,104.87087,1.0413766], [68.333466,118.68523,-4.366122], [63.744213,108.26298,30.795706], [63.469227,108.532715,21.814901], [64.92655,110.10825,16.628025], [68.14106,108.84772,11.621515], [70.28509,106.61235,7.975593], [71.485634,104.368546,4.897355], [70.91806,99.52799,-5.3800097], [65.441696,116.668625,30.911785], [58.8688,94.79956,22.576454], [73.56855,122.760956,-10.472918], [71.17596,111.7215,2.771774], [69.72586,100.27309,48.239204], [71.92996,102.05658,2.7541654], [71.66788,120.06362,4.5104446], [61.008377,97.73117,19.93233], [68.666534,116.14307,-3.5945117], [79.90991,125.161316,50.72665], [70.444466,96.86185,7.2123623], [68.409355,113.78432,-7.605583], [81.83718,143.47913,29.675936], [87.11909,146.42934,34.751537], [69.593666,116.86161,42.139725], [79.52825,138.708,35.21958], [60.663635,92.682846,34.3973], [88.44526,154.55035,14.247056], [76.04389,123.669655,-7.44906], [70.932884,114.93999,5.5697417], [62.416473,100.5245,30.3867], [63.957325,99.273575,13.848716], [66.12181,99.20911,11.595582], [80.367714,139.00873,11.263522], [68.91851,124.076004,31.918926], [94.400955,158.24806,11.814214], [90.12314,154.16777,22.600573], [88.9271,151.03365,28.123672], [67.683426,73.04588,-8.751522], [99.24039,158.6729,6.927619], [68.07003,98.58345,9.530446], [69.45937,97.62982,8.239743], [70.176765,97.105095,7.7423525], [59.034378,93.93496,26.459429], [68.31754,95.95055,8.038902], [66.31119,95.858536,9.060766], [64.075806,95.83659,11.092386], [62.150066,96.19402,13.498766], [61.348213,96.865364,15.315007], [64.14783,91.91624,42.12676], [62.638443,98.97382,15.865906], [81.050835,127.23576,-5.561292], [74.79744,129.5023,4.0437903], [71.00568,121.76546,-2.3796694], [77.81042,127.97665,-2.5528479], [72.8663,93.29486,-7.427922], [84.21912,147.93137,24.524282], [86.39351,151.3252,19.476809], [91.45016,156.71028,8.430663], [85.76007,141.12769,42.07502], [69.61218,96.41394,7.593691], [70.362885,106.2245,-4.08669], [96.532455,157.01263,3.554744], [91.68489,156.7014,17.134708], [73.08694,124.88073,41.73108], [83.05118,135.81851,4.0082655], [82.6646,137.05733,4.0095716], [82.64501,138.62115,3.8303428], [83.16048,140.52646,4.5710015], [85.38912,143.961,7.2433715], [80.31342,137.83554,9.595035], [79.33178,137.61923,10.385506], [78.50642,137.24028,10.875569], [75.626854,134.78845,12.594248], [69.28129,126.1387,23.781311], [71.16514,101.92655,-2.0914981], [70.49761,94.17639,2.614384], [70.06817,94.9821,5.6921372], [81.26888,137.80998,9.4980345], [74.8237,134.2526,28.894814], [70.66083,94.154945,-2.8140943], [86.46606,147.39804,9.420421], [71.63825,107.240814,-12.076932], [70.36472,104.02904,-7.794448], [72.20897,102.99696,-10.333042], [70.14507,112.58495,-2.2249851], [94.35948,153.3319,1.6627421], [92.76181,148.71396,1.0365156], [89.267815,148.72798,4.5972223], [80.374664,142.10953,16.648188], [71.65074,123.32294,7.316411], [83.59878,145.35376,13.331509], [68.792,122.977234,13.225092], [71.85158,127.08903,10.602827], [70.88659,128.90727,17.98038], [89.741776,153.14859,6.3355017], [70.64496,114.85865,1.0751054], [81.22342,144.30812,20.818794], [84.459755,147.85887,16.484283], [76.85232,138.12549,18.794788], [72.54698,129.9431,32.674793], [76.87525,138.15434,23.221786], [76.48977,132.08571,40.45139], [73.4076,132.04494,14.539437], [70.82409,108.893814,-0.43848544], [69.3333,120.29395,-5.29378], [69.89744,121.57142,-1.7019688], [68.12473,117.62785,-8.057098], [67.40893,91.5274,3.4440515], [63.33632,90.38385,5.856617], [60.27874,90.377335,8.936856], [58.4057,91.26353,12.95933], [57.96789,92.90763,16.544203], [61.478634,98.77266,22.06512], [66.852905,108.58011,41.283897], [63.547253,104.42055,18.973988], [65.340805,105.41321,15.358825], [67.79681,104.95463,11.805405], [70.03671,103.47922,8.643147], [71.32349,101.73164,6.1049995], [71.97307,100.28373,4.4112115], [73.80581,108.307655,51.261272], [71.29003,122.69064,-0.4966992], [69.4863,109.93356,-5.44217], [69.6105,120.31254,-8.877952], [73.108025,122.16155,-8.918472], [71.029305,120.92236,-7.5584383], [73.11185,123.88939,-0.36457515], [73.090485,122.53306,-9.843389], [75.319695,123.43802,-6.997998], [71.062935,96.87506,5.6162753], [72.09031,97.94009,2.590676], [71.851425,98.84489,0.1326997], [60.982903,97.39257,16.880634], [59.792294,95.75041,18.032494], [74.945175,107.39431,-13.362257], [104.2782,93.86878,-14.627639], [80.29432,122.69437,-9.9529705], [123.44135,71.41555,-12.068862], [93.8476,98.653725,-11.189265], [97.57493,98.51922,-12.953829], [101.30055,97.71347,-14.194713], [106.88296,94.585945,-14.966332], [90.51687,97.751175,-8.842152], [95.75172,87.56356,-15.5899515], [91.84865,88.39962,-12.899733], [100.012436,87.47197,-16.672092], [103.46614,88.35558,-16.782341], [111.09606,96.198494,-14.668305], [107.685196,149.5124,-2.8946269], [106.05249,92.57382,-14.638704], [128.27917,89.3577,-10.55995], [116.07575,91.92311,-14.820015], [98.95894,114.523,-11.743563], [86.55562,132.14914,-7.8071256], [88.593994,135.94301,-5.6920805], [92.76913,133.04652,-8.782617], [97.88498,133.78535,-8.582579], [93.03424,135.73401,-6.91371], [97.05517,135.58234,-6.498907], [107.22538,138.12149,-5.854659], [75.488945,120.35492,-14.403009], [74.395485,116.528465,-15.76928], [108.299736,82.70084,-20.060307], [89.29598,105.40373,-9.72391], [89.0235,118.55651,-13.153167], [89.59237,116.140526,-12.755933], [111.63814,112.237785,-15.210671], [74.34839,111.67667,-15.231674], [94.84043,80.800865,-18.858099], [101.900505,80.931335,-20.142967], [113.69793,66.09756,-15.761529], [78.758514,86.77799,-11.713574], [89.092674,90.000885,-10.147783], [109.09981,134.72836,-7.823311], [141.43024,126.26143,4.683691], [87.336876,121.32545,-10.537999], [84.76118,122.74318,-8.169222], [104.67572,135.21556,-6.3547316], [103.33827,135.13908,-5.8059745], [103.98393,77.22385,-20.431551], [90.930405,120.071594,-11.425439], [87.15525,82.45018,-16.141037], [86.545334,78.5812,-17.214415], [89.516975,62.076927,-17.918678], [108.43898,71.06945,-18.913809], [86.972664,69.31482,-17.487892], [111.54195,79.69985,-19.5185], [117.353874,75.63712,-16.549376], [87.487366,134.34125,-7.1368427], [92.71782,134.59723,-7.9052305], [97.34685,134.72954,-7.67122], [87.061134,122.11229,-8.971202], [103.89405,135.21927,-5.9579234], [101.624695,135.52217,-5.7590823], [102.930695,135.01863,-5.609244], [82.56761,120.42309,-13.718606], [97.26781,135.8209,-5.660484], [93.550224,136.24709,-5.3335967], [89.600464,136.70155,-4.36603], [95.742004,144.16295,-1.6611304], [92.371346,140.61398,-3.9711542], [91.10681,138.48982,-4.4364853], [90.16749,136.41544,-4.003503], [89.7689,134.8682,-3.7733684], [97.51385,134.45216,-5.234163], [98.145966,135.20938,-5.4963317], [99.01065,136.26146,-5.8836617], [100.07224,137.42082,-5.8947353], [100.04509,129.04735,-9.555673], [141.27176,105.7444,3.4723659], [100.34064,134.5542,-5.437544], [100.775154,135.02284,-5.5760155], [84.240555,124.33595,-8.037406], [91.35335,122.42278,-8.155544], [84.41393,123.60988,-8.125701], [94.099884,107.186264,-10.700258], [100.54583,109.0238,-12.803237], [91.72022,117.62696,-11.311371], [102.60934,62.81462,-17.936234], [98.512985,68.819244,-19.138685], [95.47557,76.739296,-19.651396], [104.15103,140.39497,-5.211955], [77.72135,81.295555,-13.570942], [77.18763,70.98591,-14.044869], [78.064766,62.998276,-14.798442], [104.88936,96.48091,-14.842151], [116.29581,97.903336,-14.925685], [88.33605,96.81191,-7.7819505], [109.04451,88.60585,-17.179495], [85.39118,103.26044,-9.61479], [84.33167,117.48739,-14.61619], [122.92307,99.45299,-14.438764], [113.04686,101.59636,-15.63354], [107.22616,104.19771,-14.986645], [99.57714,104.66475,-12.399506], [94.063896,103.72193,-10.206305], [89.625755,102.346245,-8.901698], [76.72344,98.84879,-9.98661], [124.43614,108.36301,-13.995119], [112.799446,86.75113,-17.94757], [76.460205,122.59164,-12.74497], [89.1543,109.630684,-10.115957], [135.62848,86.79548,-1.5317127], [85.72505,100.69637,-8.039749], [93.53821,117.605606,-8.712227], [107.85795,91.95281,-15.053645], [84.93411,114.54055,-13.951393], [142.35828,115.81856,4.551678], [88.62999,95.74032,-7.6622896], [79.288155,112.60905,-15.231206], [126.86928,139.28561,-3.8771777], [131.5454,141.97559,2.3361912], [133.74635,107.46524,-7.1694927], [131.921,133.019,-4.300529], [123.21368,81.74224,-13.135897], [110.3626,153.10664,-1.6479357], [78.42802,123.47155,-8.829191], [93.91904,112.04269,-10.297319], [120.83379,91.34753,-14.243753], [99.87608,95.80452,-13.943595], [96.587845,96.54886,-12.91625], [102.72566,136.10258,-5.9200964], [127.01939,116.42163,-11.344875], [105.91053,157.65523,3.2803135], [118.56028,151.97401,1.5878272], [124.494934,148.04845,1.751665], [93.730225,96.56681,-11.290559], [90.95392,96.052505,-9.528048], [89.368225,95.79709,-8.229312], [116.905,84.60402,-16.971207], [90.846954,93.46349,-10.542914], [93.67418,92.62673,-12.494956], [96.861885,92.21757,-14.164271], [100.3869,92.026115,-15.209868], [102.883644,92.24992,-15.393028], [130.24931,77.88275,-6.5196447], [102.26537,94.84996,-14.459232], [95.04978,127.39062,-9.308196], [86.4058,120.78795,-11.268708], [85.81126,127.27553,-8.049175], [121.66392,144.94817,-2.6003387], [116.27565,149.11696,-1.8743374], [103.5752,156.0776,-0.21581045], [137.32207,134.99167,3.515831], [89.172134,94.781,-8.879568], [80.30355,105.02594,-11.353877], [112.244316,155.31198,1.3887732], [135.5411,116.51506,-5.5147657], [93.73877,134.53705,-4.8740277], [94.446144,135.76062,-5.181054], [95.33971,137.37885,-5.7106915], [96.50393,139.19125,-5.536574], [100.31219,142.39616,-4.2248197], [100.762634,135.34393,-6.390452], [101.375336,134.96481,-7.192936], [102.05073,134.42351,-7.9133983], [104.9017,131.60555,-9.403267], [119.52797,119.89611,-12.8996315], [80.911705,100.816055,-9.585118], [83.74176,92.84575,-7.2461677], [86.959045,93.12941,-8.110642], [100.26448,135.44995,-5.7329726], [125.53997,128.59396,-8.342155], [78.58043,93.23134,-8.617753], [104.39465,145.94199,-3.3503976], [75.864204,103.32576,-11.732573], [84.6842,111.02109,-11.718994], [98.550415,148.02397,-1.4670153], [112.199875,139.2576,-5.8918247], [97.94816,120.10414,-9.546195], [109.043655,143.09503,-4.465204], [106.61014,118.352745,-13.13738], [102.67297,123.55292,-10.650346], [113.62296,124.08607,-12.217277], [101.16336,152.4748,-1.7672015], [89.05506,112.886314,-10.816317], [117.56359,141.38455,-5.04557], [112.81741,145.66727,-3.31234], [113.70704,134.59233,-8.504353], [129.0259,122.98966,-8.778934], [120.392715,134.02292,-8.154674], [135.6195,124.84398,-4.417665], [108.34053,128.27435,-10.666471], [84.80134,107.301,-10.666757], [83.28865,119.62616,-14.640559], [87.95744,120.20858,-12.378083], [79.05908,116.87297,-15.683716], [85.084854,89.213585,-10.192204], [89.984604,86.489265,-13.911732], [94.97589,85.138756,-16.614847], [100.16344,84.82071,-18.119358], [105.11715,85.94402,-18.354797], [111.48893,92.07515,-15.111512], [131.4238,98.39147,-9.303486], [108.67015,98.52329,-14.672963], [104.25259,100.3878,-13.918076], [98.95503,101.186356,-12.291106], [94.0026,100.91527,-10.325001], [90.08857,99.95973,-8.222452], [87.091896,98.947174,-7.2463427], [138.93103,96.100365,1.4856238], [89.13155,121.083626,-10.926104], [79.45583,108.74205,-12.968465], [78.83802,119.89769,-14.835074], [78.97873,122.090836,-12.388308], [80.26988,120.75254,-13.645664], [89.21315,122.269325,-9.099602], [77.817635,122.32397,-12.696816], [79.53225,123.26994,-9.387288], [86.86787,95.73968,-6.7574224], [84.41018,97.04723,-6.630745], [82.30747,97.95006,-7.5862813], [104.557686,92.4104,-15.157829], [106.512726,89.61221,-16.276615]]])

    return Landmarks2TransformMatrix(operator, custom_options, None, None, input_tensor)

sess = tf.InteractiveSession()

mat = test_Landmarks2TransformMatrix()
print(mat.eval())
gridInOrigSpace = test_TransformLandmarks(mat)
print(gridInOrigSpace.eval())

sess.close()
